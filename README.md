# Drawing Insight Desktop 開発仕様書

## ダウンロードとインストール

### Windows版
最新のWindows版は[Releasesページ](https://github.com/genkis3zu/drawing-insight-desktop/releases)からダウンロードできます。

1. `Drawing-Insight-Desktop-win.zip`をダウンロード
2. ZIPファイルを解凍
3. `Drawing Insight Desktop.exe`を実行

### 開発者向けビルド手順
```bash
# リポジトリをクローン
git clone https://github.com/genkis3zu/drawing-insight-desktop.git
cd drawing-insight-desktop

# 依存関係をインストール
npm install

# ビルド
npm run build

# Windows用実行ファイルを作成
npm run dist:win
```

## プロジェクト概要

本プロジェクトは、Electron.jsを基盤としたデスクトップアプリケーションとして、AI技術を活用した図面解析システムを開発するものです。ユーザーは図面ファイルをアップロードし、AI解析結果をテーブル形式で確認および活用することができます。

## 技術仕様

### 基盤技術
- **フレームワーク**: Electron.js（最新安定版）
- **フロントエンド**: React.js + TypeScript
- **バックエンド処理**: Node.js（Electronメインプロセス）
- **AI API**: OpenAI GPT-4 Vision API または Google Vision API
- **UI コンポーネント**: Ant Design または Material-UI
- **データ管理**: SQLite（ローカルデータベース）

### アーキテクチャ設計

#### メインプロセス（Node.js）
メインプロセスでは、ファイル操作とAI API通信を担当します。図面ファイルの読み込み、画像前処理、API リクエスト送信、レスポンス処理を実行し、セキュリティ要件に対応するため、処理後の一時ファイルは自動削除します。

#### レンダラープロセス（React.js）
レンダラープロセスでは、ユーザーインターフェースの表示と操作を担当します。図面ファイルのドラッグ＆ドロップアップロード、解析進捗の表示、結果テーブルの表示と編集機能、データのエクスポート機能を提供します。

#### データフロー
ユーザーが図面ファイルをアップロードすると、メインプロセスで画像前処理を実行し、AI APIに送信します。解析結果を受信後、構造化データに変換してローカルデータベースに保存し、レンダラープロセスでテーブル表示します。

## 機能要件

### 図面アップロード機能
対応ファイル形式はJPEG、PNG、PDF、DWG、DXFとし、ドラッグ＆ドロップおよびファイル選択ダイアログによるアップロードを可能とします。ファイルサイズ制限は50MB以内、複数ファイルの一括アップロードにも対応します。

### AI解析機能
OpenAI GPT-4 Vision APIまたはGoogle Vision APIを使用して図面解析を実行します。解析内容には、寸法情報の抽出、部品リストの識別、材質情報の抽出、図面タイトルと図番の識別が含まれます。処理時間は図面一枚あたり10秒以内を目標とします。

### データ表示機能
解析結果をテーブル形式で表示し、列の並び替え、フィルタリング、検索機能を提供します。セルの編集機能、行の追加・削除機能も実装し、データの手動修正を可能とします。

### データ管理機能
解析結果をSQLiteデータベースに保存し、プロジェクト単位での管理を行います。CSV、Excel形式でのエクスポート機能、データのバックアップ・復元機能を提供します。

## セキュリティ要件

### データ保護
図面データは処理完了後、メモリとディスクから完全削除します。API通信はHTTPS暗号化を使用し、ローカルデータベースはAES-256で暗号化します。ログファイルには機密情報を記録しません。

### アクセス制御
アプリケーション起動時の認証機能を実装し、ユーザー権限に基づく機能制限を設定します。外部ネットワークアクセスは必要最小限に制限します。

## パフォーマンス要件

### 処理時間
図面一枚あたりの解析時間は10秒以内とし、複数ファイルの並列処理により全体の処理時間を短縮します。画像前処理の最適化により、API通信時間を削減します。

### システム要件
Windows 10以上、macOS 10.14以上、RAM 8GB以上、ストレージ空き容量 2GB以上を動作環境とします。

## 実装指示（Claude Code用）

### プロジェクト初期化
Electron.jsプロジェクトを新規作成し、必要なパッケージをインストールします。TypeScriptとReact.jsの設定を行い、開発環境を構築します。

```bash
npm create electron-app@latest drawing-insight-desktop --template=typescript-webpack
cd drawing-insight-desktop
npm install react react-dom antd sqlite3 axios
npm install --save-dev @types/react @types/react-dom
```

### ディレクトリ構造
```
src/
├── main/           # メインプロセス
│   ├── main.ts
│   ├── fileHandler.ts
│   ├── aiService.ts
│   └── database.ts
├── renderer/       # レンダラープロセス
│   ├── App.tsx
│   ├── components/
│   │   ├── FileUpload.tsx
│   │   ├── AnalysisProgress.tsx
│   │   └── ResultTable.tsx
│   └── utils/
└── shared/         # 共通型定義
    └── types.ts
```

### 主要コンポーネント実装

#### メインプロセス
ファイルハンドラーでは、図面ファイルの読み込みと前処理、サポートされているファイル形式の検証、一時ファイルの管理を実装します。AI サービスでは、OpenAI またはGoogle Vision APIとの通信、レスポンスデータの構造化、エラーハンドリングを実装します。データベース管理では、SQLiteデータベースの初期化、CRUD操作、データの暗号化を実装します。

#### レンダラープロセス
ファイルアップロードコンポーネントでは、ドラッグ＆ドロップインターフェース、ファイル選択ダイアログ、アップロード進捗表示を実装します。解析進捗コンポーネントでは、リアルタイム進捗表示、処理状況の可視化、エラー状態の表示を実装します。結果テーブルコンポーネントでは、データの表形式表示、編集機能、エクスポート機能を実装します。

### API連携実装
環境変数でAPIキーを管理し、設定ファイルでAPI選択を可能とします。レート制限に対応した再試行ロジックを実装し、API レスポンスの適切な解析処理を行います。

### エラーハンドリング
包括的なエラーキャッチ機能を実装し、ユーザーフレンドリーなエラーメッセージを表示します。ログ機能を実装し、デバッグ情報を適切に記録します。

### テスト要件
ユニットテストではJestを使用してコンポーネントとAPIロジックをテストし、統合テストではElectronアプリケーション全体の動作を検証します。E2Eテストでは実際のワークフローをテストします。

## 開発フェーズ

### フェーズ1: 基盤構築
Electronアプリケーションの初期設定、基本的なUI構築、ファイルアップロード機能の実装を行います。

### フェーズ2: AI連携
AI API統合、図面解析機能の実装、結果データの構造化を行います。

### フェーズ3: データ管理
データベース実装、テーブル表示機能、編集機能の実装を行います。

### フェーズ4: 最適化
パフォーマンス改善、セキュリティ強化、エラーハンドリングの充実を行います。

## 品質保証

コード品質管理にはESLintとPrettierを使用し、TypeScriptの型チェックを徹底します。セキュリティ監査を定期的に実施し、脆弱性スキャンを実行します。ユーザビリティテストを通じて、実際の使用環境での動作を検証します。

本仕様書に基づく実装により、要求仕様を満たす高品質なAI図面解析アプリケーションの開発が可能となります。
